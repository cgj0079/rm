<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>반응 속도 테스트 게임</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center h-screen">
  <div class="text-center">
    <h1 class="text-3xl font-bold mb-4">반응 속도 테스트 게임</h1>
    <p id="instructions" class="mb-4">화면이 초록색으로 변하면 빠르게 클릭하세요! (총 5번)</p>
    <div id="gameArea" class="w-64 h-64 bg-red-500 rounded-lg mx-auto flex items-center justify-center cursor-pointer">
      <span id="gameText" class="text-white text-lg">시작하려면 클릭!</span>
    </div>
    <p id="result" class="mt-4 text-lg font-semibold"></p>
    <button id="restartBtn" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded hidden hover:bg-blue-600">다시 시작</button>
  </div>

  <script>
    const gameArea = document.getElementById('gameArea');
    const gameText = document.getElementById('gameText');
    const result = document.getElementById('result');
    const restartBtn = document.getElementById('restartBtn');

    let startTime = null, endTime, timeoutId;
    let tries = 0;
    let scores = [];
    let gameActive = false; // 게임 중 여부

    function startGame() {
      tries = 0;
      scores = [];
      result.textContent = '';
      restartBtn.classList.add('hidden');
      gameActive = true;
      nextRound();
    }

    function nextRound() {
      if (tries >= 5) return; // 이미 5번 했으면 중지

      startTime = null; // 초록 불 켜지기 전까지 측정 불가
      gameArea.classList.remove('bg-green-500');
      gameArea.classList.add('bg-red-500');
      gameText.textContent = '기다리세요...';

      const randomDelay = Math.floor(Math.random() * 3000) + 1000; // 1~4초 랜덤
      timeoutId = setTimeout(() => {
        gameArea.classList.remove('bg-red-500');
        gameArea.classList.add('bg-green-500');
        gameText.textContent = '지금 클릭!';
        startTime = new Date().getTime(); // 초록 불 켜진 시점부터만 측정 시작
      }, randomDelay);
    }

    gameArea.addEventListener('click', () => {
      if (!gameActive) { 
        startGame(); // 첫 클릭 시 게임 시작
        return;
      }

      if (tries >= 5) return; // 5번 끝나면 더 이상 측정 안 함

      if (gameArea.classList.contains('bg-red-500')) {
        clearTimeout(timeoutId);
        result.textContent = '너무 빨랐어요! 이 라운드는 무효입니다.';
        gameActive = false;
        restartBtn.classList.remove('hidden');
      } 
      else if (gameArea.classList.contains('bg-green-500') && startTime) {
        endTime = new Date().getTime();
        const reactionTime = endTime - startTime;
        scores.push(reactionTime);
        tries++;
        gameText.textContent = `${tries}번째: ${reactionTime}ms`;

        if (tries < 5) {
          setTimeout(nextRound, 1000); // 1초 후 다음 라운드
        } else {
          const avg = Math.round(scores.reduce((a, b) => a + b, 0) / scores.length);
          result.textContent = `5번 완료! 평균 반응 속도: ${avg}ms`;
          gameActive = false;
          restartBtn.classList.remove('hidden');
        }
      }
    });

    restartBtn.addEventListener('click', startGame);
  </script>
</body>
</html>
